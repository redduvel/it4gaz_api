# API для обработки данных датчиков деформации труб

Этот проект представляет собой серверное API для работы с данными датчиков деформации труб. API обеспечивает возможность загрузки, анализа и получения данных датчиков для последующей визуализации.

## Возможности

- Анализ CSV-файлов с данными датчиков
- Автоматическое определение структуры данных и типов датчиков
- Загрузка данных датчиков в базу данных
- API для получения и фильтрации данных
- Подготовка данных для последующей визуализации (визуализация будет разработана отдельно)

## Технологический стек

- **Бэкенд**: Flask (Python)
- **База данных**: Supabase
- **Обработка данных**: NumPy, Pandas

## Установка и настройка

1. Клонировать репозиторий
2. Создать виртуальное окружение:
   ```
   python -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   ```
3. Установить зависимости:
   ```
   pip install -r requirements.txt
   ```
4. Создать файл `.env` на основе `.env.example` и заполнить необходимые параметры:
   ```
   cp .env.example .env
   ```
5. Запустить приложение:
   ```
   python main.py
   ```
6. API будет доступно по адресу `http://localhost:9889/api/v1/`

## API Endpoints

### Проверка работоспособности
- `GET /api/v1/ping`: Проверка доступности сервера

### Работа с данными
- `POST /api/v1/data/analyze`: Анализ CSV-файла с данными датчиков
  - Параметры (form-data):
    - `file`: CSV-файл с данными
    - `separator`: Разделитель в CSV (по умолчанию: `;`)
  - Возвращает информацию о структуре данных, типах датчиков и предлагаемое имя таблицы

- `POST /api/v1/data/create_and_load`: Создание таблицы и загрузка данных из CSV
  - Параметры (form-data):
    - `file`: CSV-файл с данными
    - `separator`: Разделитель в CSV (по умолчанию: `;`)
    - `table_name`: Имя таблицы для создания
    - `create_table`: Флаг создания таблицы (по умолчанию: `true`)
  - Создаёт таблицу в базе данных и загружает в неё данные

### Анализ данных
- `POST /api/v1/analyze/sensor/{table_name}`: Получение данных конкретного датчика
  - Параметры (JSON):
    - `filters`: Фильтры для данных
      - `sensor_type`: Тип датчика
      - `sensor_index`: Индекс датчика
      - `time_start`: Начальное время
      - `time_end`: Конечное время
      - `value_min`: Минимальное значение
      - `value_max`: Максимальное значение
    - `page`: Номер страницы (по умолчанию: 1)
    - `page_size`: Размер страницы (по умолчанию: 20)
  - Возвращает отфильтрованные данные с пагинацией

## Принцип работы

1. Бэкенд анализирует CSV-файл с данными датчиков и определяет его структуру
2. Создаётся таблица в Supabase и данные загружаются в неё
3. Через API можно получать данные датчиков с различными фильтрами
4. Данные можно использовать для последующей визуализации (визуализация разрабатывается отдельно)

## Развёртывание на Render.com

Данное приложение настроено для лёгкого развёртывания на платформе Render.com:

1. Создайте аккаунт или войдите в существующий на [Render.com](https://render.com)

2. Из панели управления Render нажмите на "New" и выберите "Web Service"

3. Подключите ваш репозиторий GitHub

4. Настройте сервис со следующими параметрами:
   - **Имя**: it4gaz-api (или ваше предпочтительное имя)
   - **Окружение**: Python
   - **Команда сборки**: `pip install -r requirements.txt`
   - **Команда запуска**: `gunicorn main:app`

5. Добавьте следующие переменные окружения:
   - `SUPABASE_URL`: URL вашей базы данных Supabase
   - `SUPABASE_KEY`: Ключ API Supabase
   - `FLASK_DEBUG`: `False` для продакшена

6. Нажмите "Create Web Service"

Приложение будет развёрнуто и доступно по URL, предоставленному Render.

## Мониторинг и логи

После развёртывания вы можете мониторить ваше приложение и просматривать логи из панели управления Render. Это полезно для отладки любых проблем, которые могут возникнуть в продакшн-окружении. 